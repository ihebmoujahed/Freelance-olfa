-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.archivedpresence
(
    id serial NOT NULL,
    student_id integer,
    class_id integer,
    date date,
    is_present boolean,
    number_seance integer,
    archived_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT archivedpresence_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.archivedteacherattendance
(
    id serial NOT NULL,
    teacher_id integer NOT NULL,
    class_id integer NOT NULL,
    date date NOT NULL,
    is_present boolean NOT NULL,
    CONSTRAINT archivedteacherattendance_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.classelist
(
    id serial NOT NULL,
    student_id integer,
    groupnumber character varying(255) COLLATE pg_catalog."default",
    teacher_id integer,
    CONSTRAINT classelist_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.classes
(
    id serial NOT NULL,
    groupnumber character varying(255) COLLATE pg_catalog."default" NOT NULL,
    teacher_id integer,
    subject character varying(50) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT classes_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.payment
(
    id serial NOT NULL,
    student_id integer,
    amount numeric(10, 2) NOT NULL,
    payment_date date DEFAULT CURRENT_DATE,
    last_payment_date date,
    attendance_count integer DEFAULT 0,
    CONSTRAINT payment_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.presence
(
    id serial NOT NULL,
    student_id integer,
    class_id integer,
    date date,
    is_present boolean,
    number_seance integer DEFAULT 0,
    CONSTRAINT presence_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.student
(
    id serial NOT NULL,
    nom character varying(255) COLLATE pg_catalog."default",
    prenom character varying(255) COLLATE pg_catalog."default",
    numerotlfparent character varying(20) COLLATE pg_catalog."default",
    cardid character varying(50) COLLATE pg_catalog."default",
    number_seance integer DEFAULT 0,
    CONSTRAINT student_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.teacher
(
    id serial NOT NULL,
    nom character varying(255) COLLATE pg_catalog."default" NOT NULL,
    prenom character varying(255) COLLATE pg_catalog."default" NOT NULL,
    numerotlf character varying(20) COLLATE pg_catalog."default" NOT NULL,
    cardid character varying(50) COLLATE pg_catalog."default" NOT NULL,
    price character varying(100) COLLATE pg_catalog."default" NOT NULL,
    subject character varying(50) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT teacher_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.teacherattendance
(
    id serial NOT NULL,
    teacher_id integer NOT NULL,
    class_id integer NOT NULL,
    date date NOT NULL,
    is_present boolean DEFAULT true,
    CONSTRAINT teacherattendance_pkey PRIMARY KEY (id)
);

ALTER TABLE IF EXISTS public.classelist
    ADD CONSTRAINT classelist_student_id_fkey FOREIGN KEY (student_id)
    REFERENCES public.student (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.classelist
    ADD CONSTRAINT classelist_teacher_id_fkey FOREIGN KEY (teacher_id)
    REFERENCES public.teacher (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.classes
    ADD CONSTRAINT classes_teacher_id_fkey FOREIGN KEY (teacher_id)
    REFERENCES public.teacher (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.payment
    ADD CONSTRAINT payment_student_id_fkey FOREIGN KEY (student_id)
    REFERENCES public.student (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.presence
    ADD CONSTRAINT presence_class_id_fkey FOREIGN KEY (class_id)
    REFERENCES public.classes (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.presence
    ADD CONSTRAINT presence_student_id_fkey FOREIGN KEY (student_id)
    REFERENCES public.student (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.teacherattendance
    ADD CONSTRAINT teacherattendance_class_id_fkey FOREIGN KEY (class_id)
    REFERENCES public.classes (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.teacherattendance
    ADD CONSTRAINT teacherattendance_teacher_id_fkey FOREIGN KEY (teacher_id)
    REFERENCES public.teacher (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

END;